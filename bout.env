# Setup environment for running BOUT++ programs
#
# Enable by doing `source bout.env` in your terminal, or source (using the full path) in your .bashrc

module swap PrgEnv-cray/8.3.3
module swap cce/15.0.0
module swap cray-mpich/8.1.23
module load cray-python/3.9.13.1 netcdf4 cmake cray-hdf5 cray-netcdf/4.9.0.1 cray-parallel-netcdf/1.12.3.1 cray-fftw/3.3.10.3 valgrind4hpc

# Handle the fact that 'srun' must be used to run MPI programs on ARCHER2
export MPIRUN="srun --hint=nomultithread --distribution=block:block -n"

# Fix propagation of slurm flag https://docs.archer2.ac.uk/faq/upgrade-2023/
export SRUN_CPUS_PER_TASK=$SLURM_CPUS_PER_TASK